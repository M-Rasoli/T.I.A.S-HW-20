@page
@using App.Domain.Core.InspectionAppointmentAgg.Enum
@using App.EndPoints.Presentation.Razorpage.Tools
@model App.EndPoints.Presentation.Razorpage.Pages.Admin.AcceptedRequestsModel

@{
    Layout = "_AdminLayout";
}
<main class="flex-1 overflow-x-hidden overflow-y-auto md:mr-64 p-6 transition-all duration-300">

    <section id="table-section" class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">مدیریت تسک ها</h2>

        <div class="card p-6">

            <form method="get" 
                  class="mb-4 flex flex-col md:flex-row md:items-center gap-3 bg-white border border-gray-200 rounded-xl shadow-sm p-4">

                <div class="flex items-center gap-2 flex-1">
                    <label asp-for="@Model.CompanyFilter" class="text-gray-700 font-medium whitespace-nowrap">
                        انتخاب شرکت:
                    </label>

                    <select asp-for="@Model.CompanyFilter"
                            class="appearance-none bg-gray-50 border border-gray-300 text-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 font-[inherit]">

                        <option value="">همه</option>

                        @foreach (CarCompanyEnum item in Enum.GetValues(typeof(CarCompanyEnum)))
                        {
                            <option value="@item">
                                @item.GetEnumName()
                            </option>
                        }

                    </select>
                    
                </div>

                <div class="flex items-center gap-2">
                    <label asp-for="@Model.DayFilter" class="text-gray-700 font-medium whitespace-nowrap">
                        انتخاب روز:
                    </label>

                    <select asp-for="@Model.DayFilter"
                            @* onchange="this.form.submit()" *@
                            class="appearance-none bg-gray-50 border border-gray-300 text-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 font-[inherit]">

                        <option value="">همه</option>

                        @foreach (var day in Model.ReservedDays)
                        {
                            <option value="@day">
                                @day
                            </option>
                        }

                    </select>
                </div>
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-5 py-3 rounded-lg shadow transition duration-150">
                    🔍 جستجو
                </button>

            </form>


            @*    <form asp-controller="Todo" asp-action="Index" method="get" id="sortForm" class="controls" role="region" aria-label="کنترل مرتب‌سازی">
                <label for="sortSelect">مرتب‌سازی:</label>
                <select id="sortSelect" name="sortOrder" onchange="document.getElementById('sortForm').submit()">
                    <option value="default">پیش‌فرض</option>
                    <option value="title-asc">دسته بندی ↑ (A → Z)</option>
                    <option value="title-desc">دسته بندی ↓ (Z → A)</option>
                    <option value="date-desc">تاریخ نزدیک ترین → دور ترین</option>
                    <option value="date-asc">تاریخ دور ترین → نزدیک ترین</option>
                    <option value="is-done-false">انجام نشده ها</option>
                    <option value="is-done-true">انجام شده ها</option>
                </select>
            </form> *@
            <!-- Table Container (Responsive Scroll) -->
            <div class="overflow-x-auto rounded-lg border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200" id="user-table">
                    <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            کد ملی مالک
                        </th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            شماره پلاک
                        </th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            مدل خودرو
                        </th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            شماره تماس
                        </th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            وضعیت
                        </th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            سال ساخت
                        </th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            زمان نوبت
                        </th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            آدرس
                        </th>
                        
                    </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="user-table-body">

                    @foreach (var req in Model.AcceptedAppointments)
                    {
                        <tr class="hover:bg-gray-50 transition duration-150">

                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@req.OwnersNationalCode</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@req.LicensePlate</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@req.CarModel - @req.CarCompany.ToString()</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@req.MobileNumber</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <form method="post" asp-page-handler="ChangeStatus">
                                    <input type="hidden" name="RequestId" value="@req.Id" />

                                    <select name="Status"
                                            onchange="this.form.submit()"
                                            class="appearance-none bg-gray-50 border border-gray-300 text-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 font-[inherit]">

                                            <option value="@((int)req.Status)" selected>@req.Status.GetEnumName()</option>

                                        @foreach (AppointmentStatusEnum item in Enum.GetValues(typeof(AppointmentStatusEnum)))
                                        {
                                            if (item != req.Status)
                                            {
                                                <option value="@((int)item)">@item.GetEnumName()</option>
                                            }
                                        }
                                    </select>
                                </form>
                            </td>

                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@req.YearOfManufactureShamsi</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@req.TurnTimeShamsi</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@req.Address</td>

                            @* <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a asp-controller="Todo" asp-action="Delete" asp-route-taskId="@task.Id" class="px-3 py-1 bg-red-500 text-white text-xs rounded-lg hover:bg-blue-600 transition duration-150 shadow-md">ویرایش</a>
                            </td>


                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a asp-controller="Todo" asp-action="Delete" asp-route-taskId="@task.Id" class="px-3 py-1 bg-red-500 text-white text-xs rounded-lg hover:bg-blue-600 transition duration-150 shadow-md" onclick="return confirm('تسک حذف شود ؟');">حذف</a>
                            </td> *@
                        </tr>
                    }


                    </tbody>
                </table>
            </div>
        </div>
    </section>

</main>
@if (!string.IsNullOrEmpty(Model.Message))
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: 'اعلان سیستم',
                text: '@Model.Message',
                icon: 'success',
                showConfirmButton: true,
                confirmButtonText: "باشه",
                confirmButtonColor: '#4f46e5',
                timer: 3000
            });
        });
    </script>
}
@if (!string.IsNullOrEmpty(Model.error))
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: 'اعلان سیستم',
                text: '@Model.error',
                icon: 'error',
                showConfirmButton: true,
                confirmButtonText: "باشه",
                confirmButtonColor: '#4f46e5',
                timer: 3000
            });
        });
    </script>
}

